(function(d,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(d=typeof globalThis!="undefined"?globalThis:d||self,o(d["vue-universal-modal"]={},d.Vue))})(this,function(d,o){"use strict";const w=({modalRef:e,latest:l,show:s})=>{let i;function n(t){const a=t.target.closest(`.${m}`);if(!!l.value&&(!a||a!==e.value)){if(a&&!a.classList.contains(`${m}-show`))return;i=t.target}}function u(t){t?e.value&&e.value.focus():i&&i.focus()}o.onMounted(()=>{document.addEventListener("click",n),o.watch(()=>s.value,t=>{o.nextTick(()=>u(t))},{immediate:s.value})}),o.onUnmounted(()=>{document.removeEventListener("click",n)})},y=({close:e,closeClickDimmed:l,closeKeyCode:s,latest:i})=>{let n=null;function u(r){n=r.target}function t(r){l&&n===r.target&&e.value(),n=null}function a(r){r.keyCode===s&&i.value&&e.value()}return o.onMounted(()=>{s&&document.addEventListener("keyup",a)}),o.onUnmounted(()=>{s&&document.removeEventListener("keyup",a)}),{onMouseDownDimmed:u,onMouseUpDimmed:t}},b=({modalRef:e,show:l})=>{const{visibleModals:s,addVisibleModals:i,removeVisibleModals:n}=o.inject(v),u=o.computed(()=>{const t=[...s.value.values()];return!t.length||!e.value?!1:t[t.length-1]===e.value});return o.watch(()=>l.value,()=>{o.nextTick(()=>{!e.value||(l.value?i(e.value):n(e.value))})},{immediate:!0}),{latest:u}};var A=(()=>`.vue-universal-modal-leave-from,.vue-universal-modal-enter-to{opacity:1}.vue-universal-modal-enter-from,.vue-universal-modal-leave-to{opacity:0}.vue-universal-modal{-webkit-overflow-scrolling:touch;overscroll-behavior:contain;position:fixed;overflow-y:auto;left:0;top:0;right:0;bottom:0;background-color:#000c;text-align:left}.vue-universal-modal:not(.vue-universal-modal-latest){z-index:1000}.vue-universal-modal-content{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;min-height:100%}
`)(),g=(e,l)=>{const s=e.__vccOpts||e;for(const[i,n]of l)s[i]=n;return s};const h=o.defineComponent({inheritAttrs:!1,props:{fullscreen:{type:Boolean,default:!1},swipe:{type:Boolean,default:!0},close:{type:Function,default:()=>{}},disabled:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!0},options:{type:Object,default:()=>({})}},emits:["before-enter","enter","after-enter","enter-cancelled","before-leave","leave","after-leave","leave-cancelled"],setup(e,l){const{teleportTarget:s}=o.inject(v),{close:i,disabled:n,options:u,modelValue:t}=o.toRefs(e),a=o.ref(t.value===void 0?!0:t.value),r=o.ref(null),f=o.ref(!n.value),c={transition:300,closeClickDimmed:!0,closeKeyCode:27,styleModalContent:{},...u.value};o.watch([()=>t.value,()=>n.value],()=>{const p=t.value&&!n.value;f.value=p,t.value&&(a.value=t.value)},{immediate:!0});const{latest:M}=b({modalRef:r,show:f});w({latest:M,modalRef:r,show:f});const{onMouseDownDimmed:E,onMouseUpDimmed:k}=y({close:i,closeClickDimmed:c.closeClickDimmed,closeKeyCode:c.closeKeyCode,latest:M});return{Log:p=>{},CLASS_NAME:m,emitClose:()=>{i.value&&i.value()},inserted:a,latest:M,mergeOptions:c,modalRef:r,onMouseDownDimmed:E,onMouseUpDimmed2:p=>{k(p),i.value&&i.value()},onTransitionEmit:{beforeEnter:()=>l.emit("before-enter",r.value),enter:()=>l.emit("enter",r.value),afterEnter:()=>l.emit("after-enter",{targetRef:r,close:e.close}),enterCancelled:()=>l.emit("enter-cancelled",r.value),beforeLeave:()=>l.emit("before-leave",r.value),leave:()=>l.emit("leave",r.value),afterLeave:()=>{l.emit("after-leave",r.value),t.value===!1&&(a.value=!1)},leaveCancelled:()=>l.emit("leave-cancelled",r.value)},show:f,teleportTarget:s,transition:c.transition?c.transition/1e3+"s":void 0}}});function C(e,l,s,i,n,u){return e.inserted?(o.openBlock(),o.createBlock(o.Teleport,{key:0,to:e.teleportTarget,disabled:e.disabled},[o.createVNode(o.Transition,o.mergeProps({appear:"",name:e.CLASS_NAME},o.toHandlers(e.onTransitionEmit)),{default:o.withCtx(()=>{var t;return[o.withDirectives(o.createElementVNode("div",o.mergeProps({ref:"modalRef",role:"dialog",tabindex:"-1","aria-modal":"true","aria-label":"Modal window",class:[e.CLASS_NAME,{[`${e.CLASS_NAME}-show`]:e.show},{[`${e.CLASS_NAME}-latest`]:e.latest}],style:{transitionDuration:e.transition}},e.$attrs),[o.createElementVNode("div",{class:o.normalizeClass(`${e.CLASS_NAME}-content`),style:o.normalizeStyle({transitionDuration:e.transition,...(t=e.mergeOptions)==null?void 0:t.styleModalContent}),onMousedown:l[0]||(l[0]=o.withModifiers((...a)=>e.onMouseDownDimmed&&e.onMouseDownDimmed(...a),["self"])),onMouseup:l[1]||(l[1]=(...a)=>e.onMouseUpDimmed2&&e.onMouseUpDimmed2(...a))},[o.renderSlot(e.$slots,"default",{emitClose:e.emitClose}),o.renderSlot(e.$slots,"close")],38)],16),[[o.vShow,e.show]])]}),_:3},16,["name"])],8,["to","disabled"])):o.createCommentVNode("",!0)}var D=g(h,[["render",C]]);const v="VueUniversalModal",m="vue-universal-modal";var S={install:(e,l={})=>{const{teleportTarget:s="",modalComponent:i="Modal"}=l;if(!s)return;const n=o.ref(new Set),u=a=>{n.value.add(a)},t=a=>{n.value.delete(a)};e.provide(v,{teleportTarget:s,visibleModals:o.readonly(n),addVisibleModals:u,removeVisibleModals:t}),e.component(i,D)}};d.CLASS_NAME=m,d.PLUGIN_NAME=v,d.default=S,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
