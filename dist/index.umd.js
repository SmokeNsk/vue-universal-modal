(function(c,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(c=typeof globalThis!="undefined"?globalThis:c||self,o(c["vue-universal-modal"]={},c.Vue))})(this,function(c,o){"use strict";const w=({modalRef:e,latest:t,show:i})=>{let s;function a(l){const n=l.target.closest(`.${p}`);if(!!t.value&&(!n||n!==e.value)){if(n&&!n.classList.contains(`${p}-show`))return;s=l.target}}function u(l){l?e.value&&e.value.focus():s&&s.focus()}o.onMounted(()=>{document.addEventListener("click",a),o.watch(()=>i.value,l=>{o.nextTick(()=>u(l))},{immediate:i.value})}),o.onUnmounted(()=>{document.removeEventListener("click",a)})},C=({close:e,closeClickDimmed:t,closeKeyCode:i,latest:s})=>{let a=null;function u(r){a=r.target}function l(r){t&&a===r.target&&e.value(),a=null}function n(r){r.keyCode===i&&s.value&&e.value()}return o.onMounted(()=>{i&&document.addEventListener("keyup",n)}),o.onUnmounted(()=>{i&&document.removeEventListener("keyup",n)}),{onMouseDownDimmed:u,onMouseUpDimmed:l}},b=({modalRef:e,show:t})=>{const{visibleModals:i,addVisibleModals:s,removeVisibleModals:a}=o.inject(f),u=o.computed(()=>{const l=[...i.value.values()];return!l.length||!e.value?!1:l[l.length-1]===e.value});return o.watch(()=>t.value,()=>{o.nextTick(()=>{!e.value||(t.value?s(e.value):a(e.value))})},{immediate:!0}),{latest:u}};var U=(()=>`.vue-universal-modal-leave-from,.vue-universal-modal-enter-to{opacity:1}.vue-universal-modal-enter-from,.vue-universal-modal-leave-to{opacity:0}.vue-universal-modal{-webkit-overflow-scrolling:touch;overscroll-behavior:contain;position:fixed;overflow-y:auto;left:0;top:0;right:0;bottom:0;background-color:#000c;text-align:left}.vue-universal-modal:not(.vue-universal-modal-latest){z-index:1000}.vue-universal-modal-content{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;min-height:100%}
`)(),E=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i};const D=o.defineComponent({inheritAttrs:!1,props:{fullscreen:{type:Boolean,default:!1},swipe:{type:Boolean,default:!0},close:{type:Function,default:()=>{}},disabled:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!0},options:{type:Object,default:()=>({})}},emits:["before-enter","enter","after-enter","enter-cancelled","before-leave","leave","after-leave","leave-cancelled"],setup(e,t){const{teleportTarget:i}=o.inject(f),{close:s,disabled:a,options:u,modelValue:l}=o.toRefs(e),n=o.ref(l.value===void 0?!0:l.value),r=o.ref(null),M=o.ref(!a.value),m={transition:300,closeClickDimmed:!0,closeKeyCode:27,styleModalContent:{},...u.value};o.watch([()=>l.value,()=>a.value],()=>{const d=l.value&&!a.value;M.value=d,l.value&&(n.value=l.value)},{immediate:!0});const{latest:h}=b({modalRef:r,show:M});w({latest:h,modalRef:r,show:M});const{onMouseDownDimmed:k,onMouseUpDimmed:A}=C({close:s,closeClickDimmed:m.closeClickDimmed,closeKeyCode:m.closeKeyCode,latest:h}),L=d=>{A(d),s.value&&s.value()},x={beforeEnter:()=>t.emit("before-enter",r.value),enter:()=>t.emit("enter",r.value),afterEnter:()=>t.emit("after-enter",{targetRef:r,close:e.close}),enterCancelled:()=>t.emit("enter-cancelled",r.value),beforeLeave:()=>t.emit("before-leave",r.value),leave:()=>t.emit("leave",r.value),afterLeave:()=>{t.emit("after-leave",r.value),l.value===!1&&(n.value=!1)},leaveCancelled:()=>t.emit("leave-cancelled",r.value)},_=()=>{s.value&&s.value()},V=d=>{};let y=0;const B=d=>{y=d.touches[0].clientY,document.getElementsByClassName("modal")[0].style.transitionDuration="0ms"};let g=0;return{Log:V,CLASS_NAME:p,emitClose:_,inserted:n,latest:h,mergeOptions:m,modalRef:r,onMouseDownDimmed:k,onMouseUpDimmed2:L,touchModalStart:B,touchModalMove:d=>{const v=Math.round(d.touches[0].clientY-y);v!=g&&v>0&&(document.getElementsByClassName("modal")[0].style.transform=`translate3d(0, ${v}px, 0)`),g=v},touchModalEnd:d=>{d.changedTouches[0].clientY-y!=0?(document.getElementsByClassName("modal")[0].style.transitionDuration="200ms",o.nextTick(()=>{document.getElementsByClassName("modal")[0].style.transform="translate3d(0, 0%, 0)"})):document.getElementsByClassName("modal")[0].style.transitionDuration="300ms"},onTransitionEmit:x,show:M,teleportTarget:i,transition:m.transition?m.transition/1e3+"s":void 0}}});function S(e,t,i,s,a,u){return e.inserted?(o.openBlock(),o.createBlock(o.Teleport,{key:0,to:e.teleportTarget,disabled:e.disabled},[o.createVNode(o.Transition,o.mergeProps({appear:"",name:e.CLASS_NAME},o.toHandlers(e.onTransitionEmit)),{default:o.withCtx(()=>{var l;return[o.withDirectives(o.createElementVNode("div",o.mergeProps({ref:"modalRef",role:"dialog",tabindex:"-1","aria-modal":"true","aria-label":"Modal window",class:[e.CLASS_NAME,{[`${e.CLASS_NAME}-show`]:e.show},{[`${e.CLASS_NAME}-latest`]:e.latest}],style:{transitionDuration:e.transition}},e.$attrs),[o.createElementVNode("div",{class:o.normalizeClass(`${e.CLASS_NAME}-content`),style:o.normalizeStyle({transitionDuration:e.transition,...(l=e.mergeOptions)==null?void 0:l.styleModalContent}),onMousedown:t[3]||(t[3]=o.withModifiers((...n)=>e.onMouseDownDimmed&&e.onMouseDownDimmed(...n),["self"])),onMouseup:t[4]||(t[4]=(...n)=>e.onMouseUpDimmed2&&e.onMouseUpDimmed2(...n))},[o.renderSlot(e.$slots,"default",{emitClose:e.emitClose,onTouchstart:t[0]||(t[0]=o.withModifiers((...n)=>e.touchModalStart&&e.touchModalStart(...n),["self"])),onTouchmove:t[1]||(t[1]=o.withModifiers((...n)=>e.touchModalMove&&e.touchModalMove(...n),["self"])),onTouchend:t[2]||(t[2]=o.withModifiers((...n)=>e.touchModalEnd&&e.touchModalEnd(...n),["self"]))}),o.renderSlot(e.$slots,"close")],38)],16),[[o.vShow,e.show]])]}),_:3},16,["name"])],8,["to","disabled"])):o.createCommentVNode("",!0)}var N=E(D,[["render",S]]);const f="VueUniversalModal",p="vue-universal-modal";var T={install:(e,t={})=>{const{teleportTarget:i="",modalComponent:s="Modal"}=t;if(!i)return;const a=o.ref(new Set),u=n=>{a.value.add(n)},l=n=>{a.value.delete(n)};e.provide(f,{teleportTarget:i,visibleModals:o.readonly(a),addVisibleModals:u,removeVisibleModals:l}),e.component(s,N)}};c.CLASS_NAME=p,c.PLUGIN_NAME=f,c.default=T,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
