(function(d,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(d=typeof globalThis!="undefined"?globalThis:d||self,o(d["vue-universal-modal"]={},d.Vue))})(this,function(d,o){"use strict";const M=({modalRef:e,latest:t,show:i})=>{let r;function s(n){const l=n.target.closest(`.${f}`);if(!!t.value&&(!l||l!==e.value)){if(l&&!l.classList.contains(`${f}-show`))return;r=n.target}}function u(n){n?e.value&&e.value.focus():r&&r.focus()}o.onMounted(()=>{document.addEventListener("click",s),o.watch(()=>i.value,n=>{o.nextTick(()=>u(n))},{immediate:i.value})}),o.onUnmounted(()=>{document.removeEventListener("click",s)})},b=({close:e,closeClickDimmed:t,closeKeyCode:i,latest:r})=>{let s=null;function u(a){s=a.target}function n(a){t&&s===a.target&&e.value(),s=null}function l(a){a.keyCode===i&&r.value&&e.value()}return o.onMounted(()=>{i&&document.addEventListener("keyup",l)}),o.onUnmounted(()=>{i&&document.removeEventListener("keyup",l)}),{onMouseDownDimmed:u,onMouseUpDimmed:n}},w=({modalRef:e,show:t})=>{const{visibleModals:i,addVisibleModals:r,removeVisibleModals:s}=o.inject(m),u=o.computed(()=>{const n=[...i.value.values()];return!n.length||!e.value?!1:n[n.length-1]===e.value});return o.watch(()=>t.value,()=>{o.nextTick(()=>{!e.value||(t.value?r(e.value):s(e.value))})},{immediate:!0}),{latest:u}};var k=(()=>`.vue-universal-modal-leave-from,.vue-universal-modal-enter-to{opacity:1}.vue-universal-modal-enter-from,.vue-universal-modal-leave-to{opacity:0}.vue-universal-modal{-webkit-overflow-scrolling:touch;overscroll-behavior:contain;position:fixed;overflow-y:auto;left:0;top:0;right:0;bottom:0;background-color:#000c;text-align:left}.vue-universal-modal:not(.vue-universal-modal-latest){background:none}.vue-universal-modal-content{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;min-height:100%}
`)(),C=(e,t)=>{const i=e.__vccOpts||e;for(const[r,s]of t)i[r]=s;return i};const h=o.defineComponent({inheritAttrs:!1,props:{close:{type:Function,default:()=>{}},disabled:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!0},options:{type:Object,default:()=>({})}},emits:["before-enter","enter","after-enter","enter-cancelled","before-leave","leave","after-leave","leave-cancelled"],setup(e,t){const{teleportTarget:i}=o.inject(m),{close:r,disabled:s,options:u,modelValue:n}=o.toRefs(e),l=o.ref(n.value===void 0?!0:n.value),a=o.ref(null),c=o.ref(!s.value),v={transition:300,closeClickDimmed:!0,closeKeyCode:27,styleModalContent:{},...u.value};o.watch([()=>n.value,()=>s.value],()=>{const g=n.value&&!s.value;c.value=g,n.value&&(l.value=n.value)},{immediate:!0});const{latest:p}=w({modalRef:a,show:c});M({latest:p,modalRef:a,show:c});const{onMouseDownDimmed:S,onMouseUpDimmed:E}=b({close:r,closeClickDimmed:v.closeClickDimmed,closeKeyCode:v.closeKeyCode,latest:p});return{Log:g=>{},CLASS_NAME:f,emitClose:()=>{r.value&&r.value()},inserted:l,latest:p,mergeOptions:v,modalRef:a,onMouseDownDimmed:S,onMouseUpDimmed:E,onTransitionEmit:{beforeEnter:()=>t.emit("before-enter",a.value),enter:()=>t.emit("enter",a.value),afterEnter:()=>t.emit("after-enter",{targetRef:a,close:e.close}),enterCancelled:()=>t.emit("enter-cancelled",a.value),beforeLeave:()=>t.emit("before-leave",a.value),leave:()=>t.emit("leave",a.value),afterLeave:()=>{t.emit("after-leave",a.value),n.value===!1&&(l.value=!1)},leaveCancelled:()=>t.emit("leave-cancelled",a.value)},show:c,teleportTarget:i,transition:v.transition?v.transition/1e3+"s":void 0}}});function y(e,t,i,r,s,u){return e.inserted?(o.openBlock(),o.createBlock(o.Teleport,{key:0,to:e.teleportTarget,disabled:e.disabled},[o.createVNode(o.Transition,o.mergeProps({appear:"",name:e.CLASS_NAME},o.toHandlers(e.onTransitionEmit)),{default:o.withCtx(()=>{var n;return[o.withDirectives(o.createElementVNode("div",o.mergeProps({ref:"modalRef",role:"dialog",tabindex:"-1","aria-modal":"true","aria-label":"Modal window",class:[e.CLASS_NAME,{[`${e.CLASS_NAME}-show`]:e.show},{[`${e.CLASS_NAME}-latest`]:e.latest}],style:{transitionDuration:e.transition}},e.$attrs),[o.createElementVNode("div",{class:o.normalizeClass(`${e.CLASS_NAME}-content`),style:o.normalizeStyle({transitionDuration:e.transition,...(n=e.mergeOptions)==null?void 0:n.styleModalContent}),onMousedown:t[0]||(t[0]=o.withModifiers((...l)=>e.onMouseDownDimmed&&e.onMouseDownDimmed(...l),["self"])),onMouseup:t[1]||(t[1]=(...l)=>e.onMouseUpDimmed&&e.onMouseUpDimmed(...l)),onDragstart:t[2]||(t[2]=(...l)=>e.Log&&e.Log(...l)),onDrag:t[3]||(t[3]=(...l)=>e.Log&&e.Log(...l)),onDragend:t[4]||(t[4]=(...l)=>e.Log&&e.Log(...l))},[o.renderSlot(e.$slots,"default",{emitClose:e.emitClose}),o.renderSlot(e.$slots,"close")],38)],16),[[o.vShow,e.show]])]}),_:3},16,["name"])],8,["to","disabled"])):o.createCommentVNode("",!0)}var D=C(h,[["render",y]]);const m="VueUniversalModal",f="vue-universal-modal";var L={install:(e,t={})=>{const{teleportTarget:i="",teleportComponent:r="",teleportComponentId:s="",modalComponent:u="Modal"}=t;if(!i||r||s)return;const n=o.ref(new Set),l=c=>{n.value.add(c)},a=c=>{n.value.delete(c)};e.provide(m,{teleportTarget:i,visibleModals:o.readonly(n),addVisibleModals:l,removeVisibleModals:a}),e.component(u,D)}};d.CLASS_NAME=f,d.PLUGIN_NAME=m,d.default=L,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
